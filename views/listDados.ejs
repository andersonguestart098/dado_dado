<% for( i= Object.keys(dados[pegar]).length-1; i > -1; i--) { %>
        <%- include('data'); %>
<% } %>
<style>
  select, input {
   display: none;
  }
</style>
<script>
  function make(a,b){
    a.style.display='none'
    b.style.display='flex'
}
</script>
<script> 
function autoreflash(a,b) {
    let valor = a.value
    let valorAfter = b.innerText
    let pegar = "<%= pegar %>"
    let swi = a.id.split("X")
    let index = swi[1]
    let target = swi[0]

    let result = JSON.stringify({mudar: target, value: valor, pegar: pegar, index: index, valueAfter: valorAfter , numeroNf: document.querySelector("#Pvalor_numeronfX"+index).innerText}, null, 2)
fetch('https://projeto.andersonhenri15.repl.co/mudancaBancoDados', {
    method: "POST",
    body: result,
    headers: {"Content-type": "text/plain; charset=UTF-8"}
  })
  .then(function(res){ return res.json(); })
  .then(function(data){ 
    a.style.display='none'
    b.style.display='flex'
    alert( data.msg ) 
  })
}
</script>
  <script>
    let pegar = "<%= pegar %>"
    colorir(pegar)
    function colorir(c) {
    let count = document.querySelectorAll(".orientador").length
    console.log(count)
    let query
    for(let i=count-1; i > -1; i--) {
    switch(c) {
      case "expedicao2":
        query = "#PstatusdepX"+i
        break
      case "passagem":
      case "financeiro":
        query = "#stNfX"+i
        break
      case "expedicao":
        query = "#PstatusdepX"+i
        break
      case "logistica":
        query = "#PvalorstatuslogX"+i
        break
    }
    let selects = document.querySelector(query)
    console.log(selects.innerText)
    
    let corte
    switch(selects.innerText) {
      case "ENTREGUE":
      case "CLIENTE RETIROU":
      case "EMITIDA":
        corte = document.querySelector(".cordaLinha"+selects.id.split("X")[1])
        corte.style.background ="rgb(102, 178, 102)"
        corte.style.color ="rgb(255, 255, 255)"
        break
      case "EM TRANSITO":
     case "...":
      case "PENDENTE":
         corte = document.querySelector(".cordaLinha"+selects.id.split("X")[1])
        corte.style.background ="rgb(255, 165, 0)"
        corte.style.color ="rgb(255, 255, 255)"
        break
      case "AGUARDANDO ROTA":
      case "AGUARDANDO CLIENTE":
      case "RETORNOU AO VENDEDOR":
        corte = document.querySelector(".cordaLinha"+selects.id.split("X")[1])
        corte.style.background ="rgb(76, 76, 255)"
        corte.style.color ="rgb(255, 255, 255)"
        break
      case "CANCELADA":
         corte = document.querySelector(".cordaLinha"+selects.id.split("X")[1])
        corte.style.background ="rgb(255, 76, 76)"
        corte.style.color ="rgb(255, 255, 255)"
        break
    }
      //document.querySelectorAll("td p")[0].style.color="red"
    }
  }

function setData(post, pegar, i) {
  document.querySelector("#valor_datahoraX"+i).innerText = post["passagem"][i].dataHora
  document.querySelector("#valor_idX"+i).innerText = post[pegar][i].id

  document.querySelector("#Pvalor_numeronfX"+i).innerText = post["passagem"][i].numeronf
  
            //-------------------
            //    FINANCEIRO
            //-------------------
    if(pegar == "expedicao2" || pegar == "expedicao") {
      document.querySelector("#PstatusdepX"+i).innerText = post[pegar][i].statusdep
      document.querySelector("#Pvalor_quemrecebeu"+i).innerText = post[pegar][i].quemrecebeu
      colorir(pegar)
    }

    if(pegar == "passagem") {
      document.querySelector("#Pvalor_exped"+i).innerText = post["passagem"][i].exped
      document.querySelector("#valor_vendedorX"+i).innerText = post["financeiro"][i].vendedor
      document.querySelector("#valor_clienteX"+i).innerText = post["financeiro"][i].cliente
      document.querySelector("#stNfX"+i).innerText = post["financeiro"][i].statusnf
      colorir(pegar)
    }
  
    if(pegar == "financeiro") {  

      document.querySelector("#Pvalor_exped"+i).innerText = post["passagem"][i].exped
      
    document.querySelector("#stNfX"+i).innerText = post[pegar][i].statusnf
    colorir(pegar)

    document.querySelector("#valor_vendedorX"+i).innerText = post[pegar][i].vendedor
      
    document.querySelector("#valor_nropedidoX"+i).innerText = post[pegar][i].nropedido
      
    document.querySelector("#valor_clienteX"+i).innerText = post[pegar][i].cliente
    document.querySelector("#valor_tipodefaturamentoX"+i).innerText = post[pegar][i].tipodefaturamento

document.querySelector("#valor_valordopedidoX"+i).innerText = post[pegar][i].valordopedido

    document.querySelector("#valor_formapgtoX"+i).innerText = post[pegar][i].formapgto
   document.querySelector("#valor_retiraentregaX"+i).innerText = post[pegar][i].retiraentrega
    document.querySelector("#valor_localdaentregaX"+i).innerText = post[pegar][i].localdaentrega
    document.querySelector("#valor_localdecobrancaX"+i).innerText = post[pegar][i].localdecobranca
      
    document.querySelector("#valor_obs1X"+i).innerText = post[pegar][i].obs
     document.querySelector("#valor_fretedestacadoX"+i).innerText = post[pegar][i].fretedestacado
   
    document.querySelector("#valor_valorfreteX"+i).innerText = post[pegar][i].valorfrete
   
    document.querySelector("#valor_dataentregaX"+i).innerText = post[pegar][i].dataentrega
   
    document.querySelector("#Pvalor_operadorX"+i).innerText = post[pegar][i].operadornf
    
    document.querySelector("#Pvalor_obs2X"+i).innerText = post[pegar][i].obsfinanceiro
  
  }

    if(pegar == "logistica") {
      document.querySelector("#Pvalor_quemrecebeu"+i).innerText = post[pegar][i].quemrecebeu
      document.querySelector("#PmotoristaX"+i).innerText = post[pegar][i].motorista
      document.querySelector("#Pvalor_placaX"+i).innerText = post[pegar][i].placa
      document.querySelector("#PvalorstatuslogX"+i).innerText = post[pegar][i].statuslog
      colorir(pegar)
    }

  
  
}
  
let global_Up
setInterval(() => {
  fetch('https://projeto.andersonhenri15.repl.co/database')
.then(data => {
return data.json();
})
.then(post => {
  let pegar = "<%= pegar %>"
    if(global_Up == null) {
      global_Up = post
    }
    let aux1 = [Object.keys(global_Up[pegar])[Object.keys(global_Up[pegar]).length - 1]]
    let aux2 = [Object.keys(post[pegar])[Object.keys(post[pegar]).length - 1]]
  console.log(aux1+"\t"+aux2)

    for(let i= Object.keys(post[pegar]).length-1; i > -1; i--) {
      if(aux2 > aux1 || aux2 < aux1){
        console.log("CRIADO")
        window.location.reload();
      }
        setData(post, pegar, i)
      }
    })
    console.log("PING")
}, 5000)
</script>